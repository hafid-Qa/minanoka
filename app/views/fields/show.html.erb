<div class="container container-field mt-3 mb-5">
  <%= link_to "Back", :back, class: "btn btn-outline-secondary mb-4" %>
  <%= render 'fields/carousel', field: @field %>
  <div class="my-4">
    <div class="row mb-4">
      <div class="col-12 col-md-6 field-name">
        <h1 class="m-0"><%= @field.name %></h1>
      </div>
      <div class="col-12 col-md-6">
        <div class="btn-group-field">
          <% if user_signed_in? && current_user == @field.user%>
            <!-- Edit and Remove btn for field owner -->
            <%= link_to 'Edit field', edit_field_path(@field), class: "btn btn-primary btn px-4 text-nowrap btn-field" %>
            <%= link_to 'Remove field' , field_path(@field), data: { turbo_method: :delete  , turbo_confirm: "Delete a field?" }, class: "btn btn-danger btn px-4 text-nowrap btn-field" %>
          <% elsif user_signed_in? %>
            <!-- Booking form for logged in users -->
            <button type="button" class="btn btn-primary btn-lg px-5 text-nowrap float-end" data-bs-toggle="modal" data-bs-target="#exampleModal">
              Book now!
            </button>
          <% else %>
            <!-- Sign-in page for visitors -->
            <%= link_to "Book now!", new_user_session_path, class:"btn btn-primary btn-lg px-5 text-nowrap float-end" %>
          <% end %>
        </div>
      </div>
    </div>
    <h3><%= @field.location %></h3>
    <p class="field-description trix-content"><%= @field.rich_description %></p>
    <div class="field-info mt-5">
      <h2>About this field</h2>
      <p><strong>Size:</strong> <%= @field.size %> m2</p>
      <p><strong>Price:</strong> Â¥ <%= number_to_currency(@field.price, unit: "", precision: 0) %> per day</p>
    </div>
    <div class="field-info mt-5">
      <div id="map"
            data-controller="map"
            data-map-markers-value="<%= @marker.to_json %>"
            data-map-api-key-value="<%= ENV['MAPBOX_API_KEY'] %>">
      </div>
    </div>
    <div class="field-info mt-5">
      <h2>Field Owner</h2>
      <div class="d-flex align-items-end gap-3">
        <img class="avatar" style="height: 40px" src="https://source.unsplash.com/640x360?farm-worker">
        <p><%= @field.user.name %></p>
      </div>
    </div>
    <div class="field-info mt-5">
      <h2>Reviews</h2>
      <% @field.reviews.each do |review| %>
        <%= render 'fields/review', review: review %>
      <% end %>
      <%= render 'fields/new_review', review: Review.new, field: @field %>
    </div>
  </div>
  <!-- Booking form modal -->
  <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="exampleModalLabel">Booking request</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <%= render 'bookings/form', field: @field, booking: @booking %>
        </div>
      </div>
    </div>
  </div>
</div>
